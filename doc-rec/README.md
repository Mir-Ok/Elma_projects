# Сервис для извлечения данных из счетов на оплату  

   Работает с документами формата PDF, сформированных в программе 1С 

## Технологии

    Python 3.8, Flask, requests, pydantic, Pillow, pdf2image, 
    pytesseract, loguru

## Задачи

Скрипт распознает текст и помещает в переменные:
- ИНН продавца
- ИНН покупателя, 
- основание счета,
- номер счета
- дату формирования счета
- итоговую сумму к оплате

Может передать переменные дальше для заполнения связанных документов.
Если что-то отсутствует, переменная возвращает null 

### Переменные окружения

Приложение может функционировать на разных стендах, это достигается за счет 
использования переменных окружения.

```dotenv
ELMA_TOKEN 
ELMA_STAND 
ELMA_ZIP_DIRECTORY 
ELMA_PDF_DIRECTORY 
ELMA_QR_DIRECTORY 

LOGURU_LEVEL=INFO
```

### Тело запроса 

Скрипт начинает работу с приема параметров из входящего POST-запроса, который
содержит в себе имя файла, его идентификатор на сайте.
При помощи библиотеки Pydantic данные проходят валидацию. Формат json:

``` 
{
     "s3uid": "050c9bbd-d8bf-413a-b7ef-7a184190ddf9",
     "filename": "stream_sample.tiff"
} 
```

## Примеры ответа сервера

### Успешно 

``` 
{
    "data": {
        "Счет №: ": "30",
        "Дата: ": "28 февраля 2022 г.",
        "Сумма документа: ": "117018,72",
        "Основание: ": null,
        "Поставщик: ": "78******20",
        "Покупатель: ": "78******69"
    },
    "error": null
}
``` 

### Успешно, но файл не содержит искомых данных

``` 
{
    "data": {
        "Счет №: ": null,
        "Дата: ": null,
        "Сумма документа: ": null,
        "Основание: ": null,
        "Поставщик: ": null,
        "Покупатель: ": null
    },
    "error": null
}
```


### Неудача, входящие данные некорректны

``` 
{
    "data": null,
    "error": [
        {
            "body_params": [
                {
                    "loc": [
                        "uid"
                    ],
                    "msg": "Неверный uid",
                    "type": "value_error"
                }
            ]
        }
    ]
} 
```


